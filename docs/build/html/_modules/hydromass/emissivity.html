

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>hydromass.emissivity &mdash; hydromass 0.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> hydromass
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hydromass.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">hydromass</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>hydromass.emissivity</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for hydromass.emissivity</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>

<div class="viewcode-block" id="is_tool"><a class="viewcode-back" href="../../hydromass.html#hydromass.emissivity.is_tool">[docs]</a><span class="k">def</span> <span class="nf">is_tool</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check whether `name` is on PATH.&quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">distutils.spawn</span> <span class="kn">import</span> <span class="n">find_executable</span>

    <span class="k">return</span> <span class="n">find_executable</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="calc_emissivity"><a class="viewcode-back" href="../../hydromass.html#hydromass.emissivity.calc_emissivity">[docs]</a><span class="k">def</span> <span class="nf">calc_emissivity</span><span class="p">(</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">nh</span><span class="p">,</span> <span class="n">kt</span><span class="p">,</span> <span class="n">rmf</span><span class="p">,</span> <span class="n">abund</span><span class="o">=</span><span class="s1">&#39;angr&#39;</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">elow</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ehigh</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">arf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Function calc_emissivity, computes scaling factor between count rate and APEC/MEKAL norm using XSPEC. The tool performs an XSPEC simulation of an absorbed APEC model with parameters set by the user, and computes the expected count rate in the band of interest corresponding to an APEC normalization of unity. The corresponding number is then used as conversion between count rate and emission measure for the hydrostatic mass reconstruction step. Note that since the computed count rates are corrected for vignetting through the exposure map, the provided ARF should correspond to the on-axis (unvignetted) effective area.</span>
<span class="sd">    Requires that XSPEC be in path</span>

<span class="sd">    :param cosmo: Astropy cosmology object containing the definition of the used cosmology.</span>
<span class="sd">    :type cosmo: class:`astropy.cosmology`</span>
<span class="sd">    :param z: Source redshift</span>
<span class="sd">    :type z: float</span>
<span class="sd">    :param nh: Source NH in units of 1e22 cm**(-2)</span>
<span class="sd">    :type nh: float</span>
<span class="sd">    :param kt: Source temperature in keV</span>
<span class="sd">    :type kt: float</span>
<span class="sd">    :param rmf: Path to response file (RMF/RSP)</span>
<span class="sd">    :type rmf: str</span>
<span class="sd">    :param abund: Solar abundance table in XSPEC format. Defaults to &quot;angr&quot;</span>
<span class="sd">    :type abund: str</span>
<span class="sd">    :param Z: Metallicity with respect to solar. Defaults to 0.3</span>
<span class="sd">    :type Z: float</span>
<span class="sd">    :param elow: Low-energy bound of the input image in keV. Defaults to 0.5</span>
<span class="sd">    :type elow: float</span>
<span class="sd">    :param ehigh: High-energy bound of the input image in keV. Defaults to 2.0</span>
<span class="sd">    :type ehigh: float</span>
<span class="sd">    :param arf: Path to on-axis ARF (optional, in case response file is RMF)</span>
<span class="sd">    :type arf: str</span>
<span class="sd">    :return: Conversion factor</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_xspec</span> <span class="o">=</span> <span class="n">is_tool</span><span class="p">(</span><span class="s1">&#39;xspec&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_xspec</span><span class="p">:</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: XSPEC cannot be found in path&#39;</span><span class="p">)</span>

        <span class="k">return</span>

    <span class="n">H0</span> <span class="o">=</span> <span class="n">cosmo</span><span class="o">.</span><span class="n">H0</span><span class="o">.</span><span class="n">value</span>

    <span class="n">Ode</span> <span class="o">=</span> <span class="n">cosmo</span><span class="o">.</span><span class="n">Ode0</span>

    <span class="n">fsim</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;commands.xcm&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="c1"># fsim.write(&#39;query y\n&#39;)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;cosmo </span><span class="si">%g</span><span class="s1"> 0 </span><span class="si">%g</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">H0</span><span class="p">,</span> <span class="n">Ode</span><span class="p">))</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;abund </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">abund</span><span class="p">))</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;model phabs(apec)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">nh</span><span class="p">))</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">kt</span><span class="p">))</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1.0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;fakeit none</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rmf</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">arf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arf</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;10000, 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ign **-</span><span class="si">%1.2lf</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">elow</span><span class="p">))</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ign </span><span class="si">%1.2lf</span><span class="s1">-**</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ehigh</span><span class="p">))</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;log sim.txt</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;show rates</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;log none</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;quit</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fsim</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">nrmf_tot</span> <span class="o">=</span> <span class="n">rmf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.fak&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nrmf_tot</span><span class="p">)):</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm </span><span class="si">%s</span><span class="s1">.fak&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nrmf_tot</span><span class="p">))</span>

    <span class="n">srmf</span> <span class="o">=</span> <span class="n">nrmf_tot</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="n">nrmf</span> <span class="o">=</span> <span class="n">srmf</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">srmf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.fak&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nrmf</span><span class="p">)):</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm </span><span class="si">%s</span><span class="s1">.fak&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nrmf</span><span class="p">))</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;xspec &lt; commands.xcm&#39;</span><span class="p">)</span>

    <span class="n">ssim</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;grep cts/s sim.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

    <span class="n">lsim</span> <span class="o">=</span> <span class="n">ssim</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

    <span class="n">cr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lsim</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">])</span>

    <span class="c1">#ccf = 1. / cr</span>

    <span class="k">return</span> <span class="n">cr</span></div>




</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, D. Eckert

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>